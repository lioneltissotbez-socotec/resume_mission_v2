<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Missions ‚Äì Synth√®se Liciel</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <header class="header">
      <div>
        <h1>Dashboard Missions ‚Äì Synth√®se Liciel</h1>
        <p class="subtitle">
          Scan des dossiers LICIEL, fiches missions d√©taill√©es, filtres avanc√©s, export des num√©ros et sauvegarde JSON.
        </p>
      </div>
      <div class="badge">
        <span class="dot"></span> Pro ¬∑ Offline XML
      </div>
    </header>

    <!-- 1. S√©lection dossier racine -->
    <section class="card">
      <h2>1. S√©lection du dossier racine</h2>
      <div class="flex-row wrap">
        <button id="btnPickRoot" class="btn primary">üìÅ Choisir le dossier racine</button>
        <span id="rootInfo" class="info-text">Aucun dossier s√©lectionn√©.</span>
      </div>
      <p class="hint">
        Utilise Chrome / Edge r√©cents. Id√©alement en contexte s√©curis√© (https:// ou http://localhost) pour la File System Access API.
      </p>
    </section>

    <!-- 2. Param√®tres de scan -->
    <section class="card">
      <h2>2. Param√®tres de scan</h2>

      <div class="scan-modes">
        <label>
          <input type="radio" name="scanMode" value="all" checked />
          Scanner tous les sous-dossiers
        </label>
        <label>
          <input type="radio" name="scanMode" value="prefix" />
          Filtrer par pr√©fixe (1 √† 9 chiffres)
        </label>
        <label>
          <input type="radio" name="scanMode" value="list" />
          Liste de num√©ros de dossiers (coller depuis Excel)
        </label>
      </div>

      <div id="prefixBlock" class="scan-block hidden">
        <label for="inputPrefix">Pr√©fixe de dossier :</label>
        <input id="inputPrefix" type="text" maxlength="9" placeholder="Ex : 230145" />
      </div>

      <div id="listBlock" class="scan-block hidden">
        <label for="inputDossierList">Liste de num√©ros de dossiers :</label>
        <textarea id="inputDossierList" rows="4"
          placeholder="Coller ici les num√©ros de dossiers (un par ligne, ou s√©par√©s par des virgules / espaces)."></textarea>
      </div>

      <div class="scan-actions flex-row wrap">
        <button id="btnScan" class="btn success" disabled>üîç Lancer le scan</button>
        <div class="progress-wrapper">
          <div id="progressBar" class="progress-bar">
            <div id="progressFill" class="progress-fill"></div>
          </div>
          <div id="progressText" class="progress-text">En attente‚Ä¶</div>
        </div>
      </div>
    </section>

    <!-- 3. Filtres (masqu√©s avant le scan / import JSON) -->
    <section id="filtersSection" class="card hidden-block">
      <h2>3. Filtres</h2>
      <div class="filters-grid">
        <div>
          <label for="filterDO">Donneur d'ordre</label>
          <select id="filterDO" multiple></select>
          <small>Ctrl/Cmd + clic pour multi-s√©lection.</small>
        </div>
        <div>
          <label for="filterProp">Propri√©taire</label>
          <select id="filterProp" multiple></select>
          <small>Ctrl/Cmd + clic pour multi-s√©lection.</small>
        </div>
        <div>
          <label for="filterOp">Diagnostiqueur</label>
          <select id="filterOp" multiple></select>
          <small>Nom Pr√©nom / Soci√©t√©.</small>
        </div>
        <div>
          <label for="filterType">Type de mission</label>
          <select id="filterType" multiple></select>
          <small>Diagnostics r√©ellement effectu√©s.</small>
        </div>
        <div>
          <label for="filterConclusion">Conclusion (texte)</label>
          <input id="filterConclusion" type="text" placeholder="Recherche plein texte dans les conclusions‚Ä¶" />
          <small>Filtre appliqu√© en temps r√©el.</small>
        </div>
      </div>
      <div class="flex-row filter-actions">
        <div class="flex-row">
          <button id="btnApplyFilters" class="btn">Appliquer les filtres</button>
          <button id="btnResetFilters" class="btn secondary">R√©initialiser</button>
        </div>
        <span id="statsText" class="info-text"></span>
      </div>
    </section>

    <!-- 4. Export & sauvegarde -->
    <section class="card">
      <h2>4. Export & sauvegarde</h2>
      <div class="flex-row wrap">
        <button id="btnExportCSV" class="btn" disabled>‚¨áÔ∏è Exporter num√©ros (CSV)</button>
        <button id="btnCopyClipboard" class="btn" disabled>üìã Copier num√©ros (presse-papier)</button>
        <button id="btnExportJSON" class="btn secondary" disabled>üíæ Exporter base compl√®te (JSON)</button>
        <button id="btnImportJSON" class="btn secondary">üìÇ Charger base JSON existante</button>
        <input id="jsonFileInput" type="file" accept="application/json" class="hidden" />
      </div>
      <p class="hint">
        L‚Äôexport JSON permet de r√©utiliser la base sans rescanner les dossiers (partageable entre coll√®gues).
      </p>
    </section>

    <!-- 5. R√©sultats -->
    <section class="card">
      <h2>5. R√©sultats</h2>
      <div id="tableWrapper" class="table-wrapper">
        <table id="resultsTable">
          <thead>
            <tr>
              <th>N¬∞ dossier</th>
              <th>Donneur d'ordre</th>
              <th>Propri√©taire</th>
              <th>Adresse immeuble</th>
              <th>Type / nature bien</th>
              <th>Dates</th>
              <th>Diagnostiqueur</th>
              <th>Missions effectu√©es</th>
              <th>Fiche mission</th>
              <th>Photo</th>
            </tr>
          </thead>
          <tbody>
            <!-- Lignes g√©n√©r√©es dynamiquement -->
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- Modale fiche mission d√©taill√©e -->
  <div id="modalOverlay" class="modal-overlay hidden">
    <div class="modal modal-fiche">
      <div class="modal-header">
        <div>
          <h3 id="ficheTitle">Fiche mission</h3>
          <p id="ficheSubtitle" class="fiche-subtitle"></p>
        </div>
        <div class="modal-header-actions">
          <button id="btnExportFiche" class="btn small secondary">‚¨áÔ∏è Exporter fiche (JSON)</button>
          <button id="btnCloseModal" class="btn small">‚úñ</button>
        </div>
      </div>
      <div class="modal-content fiche-content">
        <!-- 1. Admin -->
        <section class="fiche-section">
          <h4>1. Informations administratives</h4>
          <div class="fiche-grid">
            <div class="fiche-block">
              <h5>1.1 Donneur d‚Äôordre</h5>
              <div id="ficheDO" class="fiche-text"></div>
            </div>
            <div class="fiche-block">
              <h5>1.2 Propri√©taire</h5>
              <div id="ficheProp" class="fiche-text"></div>
            </div>
          </div>
          <div class="fiche-grid">
            <div class="fiche-block">
              <h5>1.3 Immeuble</h5>
              <div id="ficheImmeuble" class="fiche-text"></div>
            </div>
            <div class="fiche-block">
              <h5>1.4 Mission</h5>
              <div id="ficheMission" class="fiche-text"></div>
            </div>
          </div>
        </section>

        <!-- 2. Visuels -->
        <section class="fiche-section">
          <h4>2. Documentation visuelle</h4>
          <div class="fiche-grid">
            <div class="fiche-block">
              <h5>2.1 Photo de pr√©sentation</h5>
              <div id="fichePhotoContainer" class="fiche-photo-wrapper">
                <div class="fiche-photo-placeholder">Aucune photo trouv√©e</div>
              </div>
            </div>
            <div class="fiche-block">
              <h5>2.2 √âtiquettes DPE</h5>
              <div id="ficheDPEContainer" class="fiche-dpe-wrapper">
                <div class="fiche-dpe-placeholder">DPE non r√©alis√© ou √©tiquettes non trouv√©es</div>
              </div>
            </div>
          </div>
        </section>

        <!-- 3. Diagnostiques -->
        <section class="fiche-section">
          <h4>3. Synth√®se par diagnostic</h4>
          <div id="ficheDiagsContainer" class="fiche-diags">
            <!-- Cartes diagnostics g√©n√©r√©es en JS -->
          </div>
        </section>

        <!-- 4. R√©cap global -->
        <section class="fiche-section">
          <h4>4. R√©capitulatif global</h4>
          <div id="ficheSummaryContainer" class="fiche-summary">
            <!-- Tableau recap g√©n√©r√© en JS -->
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Modale photo plein √©cran -->
  <div id="photoOverlay" class="modal-overlay hidden">
    <div class="modal modal-photo">
      <div class="modal-header">
        <h3>Photo de pr√©sentation</h3>
        <button id="btnClosePhoto" class="btn small">‚úñ</button>
      </div>
      <div class="modal-content photo-content">
        <img id="modalPhoto" alt="Photo de pr√©sentation" />
      </div>
    </div>
  </div>

  <script src="app.js" defer></script>
</body>
</html>
